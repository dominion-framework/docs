<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Factories and models — Dominion Node.js framework for RESTful APIs</title>
    <meta name="description" content="Dominion is declarative Promise based Node.js framework for RESTful API" />
    <meta content="width=device-width, initial-scale=1.0,minimum-scale=1.0,user-scalable=yes" name="viewport" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    <link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link href="/assets/style.css" type="text/css" rel="stylesheet" />
    <script src="/assets/clipboard.min.js" async></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97343130-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-97343130-2');
    </script>
</head>
<body>
<div class="doc-page">
    <nav class="menu toc-menu">
        <button class="menu-toggle-button" onclick="document.querySelector('.toc-menu div.collapsible').classList.toggle('open')">
            <div class="menu-toggle"></div>
        </button>
        <div class="menu-item logo">
            <a class="link" href="/"><img src="/assets/logo.svg" /></a>
        </div>
        <div class="collapsible">
            <div class="links">
                <a href="https://www.npmjs.com/package/@dominion-framework/dominion" style="width: 32px;" target="_blank">
                    <svg viewBox="0 0 256 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet"><path d="M0 0v85.498h71.166V99.83H128V85.498h128V0H0z" fill="#000"/><path d="M42.502 14.332h-28.17v56.834h28.17V28.664h14.332v42.502h14.332V14.332H42.502zM85.498 14.332v71.166h28.664V71.166h28.17V14.332H85.498zM128 56.834h-13.838v-28.17H128v28.17zM184.834 14.332h-28.17v56.834h28.17V28.664h14.332v42.502h14.332V28.664h14.332v42.502h14.332V14.332h-57.328z" fill="#FFF"/></svg>
                </a>
                <a href="https://gitter.im/dominion-framework/community" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M10 2a1 1 0 0 0-1 1v27a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1h-4zm9 7a1 1 0 0 0-1 1v37a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4zm9 0a1 1 0 0 0-1 1v37a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4zm9 0a1 1 0 0 0-1 1v20a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4z"/></svg>
                </a>
                <a href="https://github.com/dominion-framework/dominion" target="_blank">
                    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m256 0c-140.609375 0-256 115.390625-256 256 0 119.988281 84.195312 228.984375 196 256v-84.695312c-11.078125 2.425781-21.273438 2.496093-32.550781-.828126-15.128907-4.464843-27.421875-14.542968-36.546875-29.910156-5.816406-9.8125-16.125-20.453125-26.878906-19.671875l-2.636719-29.882812c23.253906-1.992188 43.371093 14.167969 55.3125 34.230469 5.304687 8.921874 11.410156 14.152343 19.246093 16.464843 7.574219 2.230469 15.707032 1.160157 25.183594-2.1875 2.378906-18.972656 11.070313-26.074219 17.636719-36.074219v-.015624c-66.679687-9.945313-93.253906-45.320313-103.800781-73.242188-13.976563-37.074219-6.476563-83.390625 18.238281-112.660156.480469-.570313 1.347656-2.0625 1.011719-3.105469-11.332032-34.230469 2.476562-62.546875 2.984375-65.550781 13.078125 3.867187 15.203125-3.890625 56.808593 21.386718l7.191407 4.320313c3.007812 1.792969 2.0625.769531 5.070312.542969 17.371094-4.71875 35.683594-7.324219 53.726563-7.558594 18.179687.234375 36.375 2.839844 54.464844 7.75l2.328124.234375c-.203124-.03125.632813-.148437 2.035157-.984375 51.972656-31.480469 50.105469-21.191406 64.042969-25.722656.503906 3.007812 14.128906 31.785156 2.917968 65.582031-1.511718 4.65625 45.058594 47.300781 19.246094 115.753906-10.546875 27.933594-37.117188 63.308594-103.796875 73.253907v.015624c8.546875 13.027344 18.816406 19.957032 18.761719 46.832032v105.722656c111.808594-27.015625 196-136.011719 196-256 .003906-140.609375-115.386719-256-255.996094-256zm0 0"/></svg>
                </a>
            </div>
            <ul>
                <li class="menu-item">
                    <a class="link" href="/quick-start">Quick Start</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/lifecycle">Request Lifecycle</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/components">Components</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/controllers">Controller</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="/controllers/uri-creation">URI Creation</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="/controllers/http-message">HTTP Message</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/annotations">Annotations</a>
                    <ul class="submenu">
                        <li class="menu-item"><a class="link" href="#path">@path</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#summary">@summary</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#description">@description</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#model">@model</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#deprecated">@deprecated</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link active" href="/factories-and-models">Factories and Models</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="/factories-and-models/factory-prototype">Factory prototype</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="/factories-and-models/model-prototype">Model prototype</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/properties">Properties</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="#number">.number()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#string">.string()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#object">.object()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#date">.date()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#enum">.enum()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#set">.set()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#model">.model()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#id-uuid">.id(), .uuid()</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/repositories">Repositories</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/interceptors">Interceptors</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/configurations">Configurations</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="markdown-body"><h1>Factories and Models</h1>
<p>Model is representing a single resource in terms of RESTful APIs.
It lists properties associated with business model and contains
methods that may manipulate model’s state. Commonly Models structure
has 1:1 mapping with persistent storage.</p>
<p>Collection of models is managed by Factories. Basically, two main
functions of a factory is to create a new Model instance or retrieve
collection of models from some storage.</p>
<p>Cool thing in models declaration in Dominion framework is
ability to specify extra features for each Model’s property.
It includes: data validation, input modification, output modification
and documentation info. More about this you can read
on <a href="/properties">Properties</a> page.</p>
<p>By default <a href="/factories-and-models/factory-prototype">Factories prototype</a>
and <a href="/factories-and-models/model-prototype">Models prototype</a>
contain the most common manipulations you will need in a project.
And of course, you can extend or overwrite it using <code>factory:</code> and <code>instance:</code>
properties in a Factory declaration.</p>
<h2>Writing a factory</h2>
<p>Files containing factory declaration should export an object with
model’s properties and prototypes for models factories and
models instances.</p>
<p>Factory declaration object has following properties:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>name</em></td>
<td style="text-align:left">String, required. Model’s name. Good practice is to keep model’s name always in plural to avoid ambiguity.</td>
</tr>
<tr>
<td style="text-align:left"><em>repository</em></td>
<td style="text-align:left">Object, optional. Repository object the model is linked to.</td>
</tr>
<tr>
<td style="text-align:left"><em>properties</em></td>
<td style="text-align:left">Object, required. Object containing model’s properties. Object keys will be properties’ names, values - properties validators.</td>
</tr>
<tr>
<td style="text-align:left"><em>factory</em></td>
<td style="text-align:left">Object, optional. Object containing functions that will be used to extend model’s factory prototype.</td>
</tr>
<tr>
<td style="text-align:left"><em>instance</em></td>
<td style="text-align:left">Object, optional. Object containing functions that will be used to extend model’s prototype.</td>
</tr>
</tbody>
</table>
<h2>Code example</h2>
<pre class="hljs"><button data-clipboard-target="#_3gga" title="Copy to clipboard"><svg viewBox="-40 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m271 512h-191c-44.113281 0-80-35.886719-80-80v-271c0-44.113281 35.886719-80 80-80h191c44.113281 0 80 35.886719 80 80v271c0 44.113281-35.886719 80-80 80zm-191-391c-22.054688 0-40 17.945312-40 40v271c0 22.054688 17.945312 40 40 40h191c22.054688 0 40-17.945312 40-40v-271c0-22.054688-17.945312-40-40-40zm351 261v-302c0-44.113281-35.886719-80-80-80h-222c-11.046875 0-20 8.953125-20 20s8.953125 20 20 20h222c22.054688 0 40 17.945312 40 40v302c0 11.046875 8.953125 20 20 20s20-8.953125 20-20zm0 0"/></svg></button><code class="highlight" id="_3gga"><span class="hljs-keyword">const</span> Errors = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@dominion-framework/dominion/core/errors"</span>);
<span class="hljs-keyword">const</span> Property = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@dominion-framework/dominion/core/property"</span>);

<span class="hljs-keyword">const</span> UsersRepository = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./repository"</span>);


<span class="hljs-built_in">module</span>.exports = {

    <span class="hljs-attr">name</span>: <span class="hljs-string">"Users"</span>,

    <span class="hljs-attr">repository</span>: UsersRepository, 

    <span class="hljs-attr">properties</span>: {
        <span class="hljs-attr">id</span>: Property.id(),
        <span class="hljs-attr">phoneNumber</span>: Property.number().min(<span class="hljs-number">1e11</span>).max(<span class="hljs-number">1e12</span><span class="hljs-number">-1</span>),
        <span class="hljs-attr">email</span>: Property.string().pattern(<span class="hljs-regexp">/\S+@\S\(.\S)+/</span>).max(<span class="hljs-number">100</span>),
        <span class="hljs-attr">passwordHash</span>: Property.string().max(<span class="hljs-number">255</span>).private(),
        <span class="hljs-attr">passwordSalt</span>: Property.string().max(<span class="hljs-number">255</span>).private(),
        <span class="hljs-attr">creationTime</span>: Property.date().private(),
        <span class="hljs-attr">modificationTime</span>: Property.date().private()
    },

    <span class="hljs-attr">factory</span>: {

        getActiveUsers(limit = <span class="hljs-number">6</span>, offset = <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.repo.getActiveUsers(limit, offset)
                .then(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> <span class="hljs-built_in">Promise</span>.all(users.map(<span class="hljs-function"><span class="hljs-params">mix</span> =&gt;</span> <span class="hljs-keyword">this</span>.new(mix, <span class="hljs-literal">false</span>))));
        }

    },

    <span class="hljs-attr">instance</span>: {

        checkPassword(password) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.passwordHash === createHash(password, <span class="hljs-keyword">this</span>.passwordSalt)) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Errors.Unauthorized(<span class="hljs-string">"Incorrect credentials"</span>);
            }
        },

        setPassword(password) {
            <span class="hljs-keyword">let</span> [passwordHash, passwordSalt] = hash(password);
            <span class="hljs-keyword">this</span>.populate({passwordHash, passwordSalt});
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

    }
};
</code></pre>
</div>
</div>
</body>
</html>
