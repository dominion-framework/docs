<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lifecycle — Dominion Node.js framework for REST APIs</title>
    <meta name="description" content="Dominion is declarative Promise based Node.js framework for RESTful API" />
    <meta content="width=device-width, initial-scale=1.0,minimum-scale=1.0,user-scalable=yes" name="viewport" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    <link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link href="/assets/style.css" type="text/css" rel="stylesheet" />
    <script src="/assets/clipboard.min.js" async></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97343130-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-97343130-2');
    </script>
</head>
<body>
<div class="doc-page">
    <nav class="menu toc-menu">
        <button class="menu-toggle-button" onclick="document.querySelector('.toc-menu div.collapsible').classList.toggle('open')">
            <div class="menu-toggle"></div>
        </button>
        <div class="menu-item logo">
            <a class="link" href="/"><img src="/assets/logo.svg" /></a>
        </div>
        <div class="collapsible">
            <div class="links">
                <a href="https://www.npmjs.com/package/@dominion-framework/dominion" style="width: 32px;" target="_blank">
                    <svg viewBox="0 0 256 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet"><path d="M0 0v85.498h71.166V99.83H128V85.498h128V0H0z" fill="#000"/><path d="M42.502 14.332h-28.17v56.834h28.17V28.664h14.332v42.502h14.332V14.332H42.502zM85.498 14.332v71.166h28.664V71.166h28.17V14.332H85.498zM128 56.834h-13.838v-28.17H128v28.17zM184.834 14.332h-28.17v56.834h28.17V28.664h14.332v42.502h14.332V28.664h14.332v42.502h14.332V14.332h-57.328z" fill="#FFF"/></svg>
                </a>
                <a href="https://gitter.im/dominion-framework/community" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M10 2a1 1 0 0 0-1 1v27a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1h-4zm9 7a1 1 0 0 0-1 1v37a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4zm9 0a1 1 0 0 0-1 1v37a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4zm9 0a1 1 0 0 0-1 1v20a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V10a1 1 0 0 0-1-1h-4z"/></svg>
                </a>
                <a href="https://github.com/dominion-framework/dominion" target="_blank">
                    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m256 0c-140.609375 0-256 115.390625-256 256 0 119.988281 84.195312 228.984375 196 256v-84.695312c-11.078125 2.425781-21.273438 2.496093-32.550781-.828126-15.128907-4.464843-27.421875-14.542968-36.546875-29.910156-5.816406-9.8125-16.125-20.453125-26.878906-19.671875l-2.636719-29.882812c23.253906-1.992188 43.371093 14.167969 55.3125 34.230469 5.304687 8.921874 11.410156 14.152343 19.246093 16.464843 7.574219 2.230469 15.707032 1.160157 25.183594-2.1875 2.378906-18.972656 11.070313-26.074219 17.636719-36.074219v-.015624c-66.679687-9.945313-93.253906-45.320313-103.800781-73.242188-13.976563-37.074219-6.476563-83.390625 18.238281-112.660156.480469-.570313 1.347656-2.0625 1.011719-3.105469-11.332032-34.230469 2.476562-62.546875 2.984375-65.550781 13.078125 3.867187 15.203125-3.890625 56.808593 21.386718l7.191407 4.320313c3.007812 1.792969 2.0625.769531 5.070312.542969 17.371094-4.71875 35.683594-7.324219 53.726563-7.558594 18.179687.234375 36.375 2.839844 54.464844 7.75l2.328124.234375c-.203124-.03125.632813-.148437 2.035157-.984375 51.972656-31.480469 50.105469-21.191406 64.042969-25.722656.503906 3.007812 14.128906 31.785156 2.917968 65.582031-1.511718 4.65625 45.058594 47.300781 19.246094 115.753906-10.546875 27.933594-37.117188 63.308594-103.796875 73.253907v.015624c8.546875 13.027344 18.816406 19.957032 18.761719 46.832032v105.722656c111.808594-27.015625 196-136.011719 196-256 .003906-140.609375-115.386719-256-255.996094-256zm0 0"/></svg>
                </a>
            </div>
            <ul>
                <li class="menu-item">
                    <a class="link" href="/quick-start">Quick Start</a>
                </li>
                <li class="menu-item">
                    <a class="link active" href="/lifecycle">Request Lifecycle</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/components">Components</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/controllers">Controller</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="/controllers/uri-creation">URI Creation</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="/controllers/http-message">HTTP Message</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/annotations">Annotations</a>
                    <ul class="submenu">
                        <li class="menu-item"><a class="link" href="#path">@path</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#summary">@summary</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#description">@description</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#model">@model</a>
                        </li>
                        <li class="menu-item"><a class="link" href="#deprecated">@deprecated</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/factories-and-models">Factories and Models</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="/factories-and-models/factory-prototype">Factory prototype</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="/factories-and-models/model-prototype">Model prototype</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/properties">Properties</a>
                    <ul class="submenu">
                        <li class="menu-item">
                            <a class="link" href="#number">.number()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#string">.string()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#object">.object()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#date">.date()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#enum">.enum()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#set">.set()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#model">.model()</a>
                        </li>
                        <li class="menu-item">
                            <a class="link" href="#id-uuid">.id(), .uuid()</a>
                        </li>
                    </ul>
                </li>
                <li class="menu-item">
                    <a class="link" href="/repositories">Repositories</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/interceptors">Interceptors</a>
                </li>
                <li class="menu-item">
                    <a class="link" href="/config">Config</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="markdown-body"><h1>API Request Lifecycle</h1>
<p>To understand how requests are processed in Dominion framework
lets look on their lifecycle, it’s straight forward:</p>
<p><img src="/assets/lifecycle.png" alt="Request promise lifecycle"></p>
<ol>
<li>
<p>On startup framework goes through all registered controllers,
generates URI based on functions interface and make mappings
between URI’s and those functions.</p>
</li>
<li>
<p>Client makes request to API server.</p>
</li>
<li>
<p>Framework’s router catches a request and looking
for matching endpoints from ones registered in controllers.</p>
</li>
<li>
<p>If match was found, router builds <strong>request Promise chain</strong>. This means that
all functions in a chain will receive as an argument execution result of previous
function or Promise resolution returned by previous function. Also, if any of
the function throws an exception all consequent functions will not be executed,
unless there will be <code>.catch()</code> with manual exception handling.<br>
A chain contains <em>request interceptors</em>,  <em>endpoint function</em> (function defined in a controller),
<em>response interceptors</em> and <em>request finalisation</em>.
Afterwards, request promise chain gets executed.</p>
<ol>
<li>Requests interceptors are taking from <code>requestInterceptors</code> array in component’s
declaration file. They are general purpose functions that may validate
client’s authorization.</li>
<li>Then <code>endpoint</code> gets executed. It defines top level business logic.
Usually controller’s <code>endpoints</code> manipulates models created by <code>Factories</code>.
If needed, factories or model instances call linked <code>Repository</code>
to create/modify/remove data in DB or other permanent storage.
<code>endpoint</code> may return Promise, serializable Object or primitive.</li>
<li>Result of <code>endpoint</code> execution is passed to response interceptors. They are taking
from <code>responseInterceptors</code> array in component’s declaration file. There are no common use
for response interceptor, as <code>endpoint</code> is responsible to produce response that is
ready to be send back to client. However, it may be used to perform some general actions
that depends on <code>endpoint</code>'s response, like set custom header.</li>
<li>Lastly, router handles common exceptions produced by <code>endpoint</code>, <code>Factories</code> or <code>Repositoy</code>. If any, it will
set proper status code (400 - for bad request, 404 - if model not found, 409 - for conflicts, etc).</li>
</ol>
</li>
<li>
<p>After it’s done, response produced by all previous steps gets stringified and returned to a client.</p>
</li>
</ol>
</div>
</div>
</body>
</html>
